<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div>V12</div>
<button type="button" onclick="requestDeviceOrientation()">Access Orientation</button>
<div id="msgDiv"></div>
<div id="msgDiv2"></div>

<script>

    var msgDiv = $("#msgDiv");
    var msgDiv2 = $("#msgDiv2");

    var base_vales = {
         setup: false,
         alpha: 0,
         beta: 0,
         gamma: 0
    };

    var last_values = {
        alpha: 0,
        beta: 0,
        gamma: 0
    };

    var max = 0;

    var peak_acc = 0;

    var setup = false;

    //https://developer.apple.com/forums/thread/128376
    function requestDeviceOrientation () {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation, true);
                    }
                })
                .catch(console.error);
        } else {
            // handle regular non iOS 13+ devices
            console.log ("not iOS");
            window.addEventListener('deviceorientation', handleOrientation, true)
        }
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
            DeviceMotionEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('devicemotion', handleMotion, true);
                    }
                })
                .catch(console.error);
        } else {
            // handle regular non iOS 13+ devices
            console.log ("not iOS");
            window.addEventListener('devicemotion', handleMotion, true)
        }
    }

    function handleOrientation(event) {
        var absolute = event.absolute;
        var alpha    = event.alpha;
        var beta     = event.beta;
        var gamma    = event.gamma;

        if(!base_vales["setup"]){
            base_vales["alpha"] = alpha;
            base_vales["beta"] = beta;
            base_vales["gamma"] = gamma;
            base_vales["setup"] = true;
        }

        last_values["alpha"] = alpha;
        last_values["beta"] = beta;
        last_values["gamma"] = gamma;

        // msgDiv.html(diff_alpha);

    }

    function handleMotion(event){
        var acc = Math.max(Math.abs(event.acceleration.x), Math.abs(event.acceleration.y), Math.abs(event.acceleration.z));

        if(acc < 5){
            console.log(peak_acc);
            diff_a = Math.abs(last_values["alpha"] - base_vales["alpha"]);
            diff_b = Math.abs(last_values["beta"] - base_vales["beta"]);
            diff_c = Math.abs(last_values["gamma"] - base_vales["gamma"]);
            if(peak_acc >= 60){
                if(diff_a >= diff_b && diff_a >= diff_c){
                    msgDiv.html("Fast Alpha");
                }
                else{
                    if(diff_b >= diff_c){
                        msgDiv.html("Fast Beta")
                    }
                    else{
                        msgDiv.html("Fast Gamma")
                    }
                }
            }
            else{
                if(peak_acc >= 20){
                    if(diff_a >= diff_b && diff_a >= diff_c){
                        msgDiv.html("Alpha");
                    }
                    else{
                        if(diff_b >= diff_c){
                            msgDiv.html("Beta")
                        }
                        else{
                            msgDiv.html("Gamma")
                        }
                    }
                }
                else{
                    msgDiv.html("You haven't gone")
                }
            }
            peak_acc = 0;
        }
        else{
            if(acc > peak_acc){
                peak_acc = acc;
            }

        }

        // if(Math.abs(event.acceleration.x) > Math.abs(max)){
        //     max = event.acceleration.x;
        // }
        msgDiv2.html(event.acceleration.x);
    }




</script>

</body>
</html>