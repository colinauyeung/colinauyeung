<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> <!--320-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;0,900;1,300&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js" integrity="sha512-BCMqEPl2dokU3T/EFba7jrfL4FxgY6ryUh4rRC9feZw4yWUslZ3Uf/lPZ5/5UlEjn4prlQTRfIPYQkDrLCZJXA==" crossorigin="anonymous"></script>
    <script
            src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
            crossorigin="anonymous"></script>
    <script src="js/d3-xyzoom.js"></script>
    <style>
        body{
            background-color: #255459;
        }
        .flex-container {
            display:flex;

        }

        .fill-width{
            flex: 1;
        }

        .button{
            background-color: transparent;
            color: #EEF1F7;
            font-family: 'Lato', sans-serif;
            font-weight: 900;
            font-size: 16px;
            width: 50%;
            height: 32px;
            border: transparent;

            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */

        }
        .button:active {
            background-color: #3a4a59;
            position:relative;
        }

        textarea {
            outline: none;
            font-family: 'Lato', sans-serif;
            font-weight: 400;
            font-size: 16px;
        }



    </style>
</head>
<body>
    <div class="flex-container">

        <textarea name="text" class="fill-width" id="textarea" rows="2" cols="10" wrap="soft" maxlength="100" style="overflow:hidden; resize:none;">  </textarea>
        <!--        <input type="textarea" class="fill-width" id="fname" name="fname" wrap="soft">-->




    </div>
    <div class="flex-container">
        <button type="button" class="button" onclick=""></button>



        <button type="button" class="button" onclick=""><</button>


    </div>
    <div id="chatcontainer"></div>

    <script>

        var count = 0;

        const tarray = {
            "slide":{
                "x": -300,
                "y": 5,
                "opacity": 0,
                "duration": 1000
            }
        };

        var messages = [
            // {
            //     "message": "blah blah blah",
            //     "trans": "slide",
            //     "id": 1
            // }
        ];

        $("textarea").keydown(function(e){
            if (e.keyCode == 13)
            {
                e.preventDefault();
            }
        });

        const w  = window.innerWidth || document.documentElement.clientWidth ||
            document.body.clientWidth;
        var h = window.innerHeight|| document.documentElement.clientHeight||
            document.body.clientHeight;

        h = h - 80;



        const viewbox = d3.select("#chatcontainer")
            .append("svg")
            .attr("preserveAspectRatio", "xMinYMin meet")
            .attr("viewBox", "0 0 " + w + " " + h);
            // .style("background", "#c9e8fd");

        const svg = viewbox.append("g")
            .attr("id", "svgcontainer");

        // svg.append('rect')
        //     .attr("rx", 6)
        //     .attr("ry", 6)
        //     .attr("width", 300)
        //     .attr("height", 60)
        //     .attr("x", w - 300)
        //     .attr("y", 5)
        //     .style("fill", "blue");


        var oscale = d3.scaleLinear()
            .domain([0, 8])
            .range([1, 0]);


        function addmessage(){



            messages.unshift(
                {
                    "message": "blah blah blah",
                    "trans": "slide",
                    "id": uuidv4()
                }
            );

            if(messages.length > 9){
                messages.pop();
            }
            count++;
            console.log(messages);


            let t = d3.transition()
                .ease(d3.easeLinear)
                .duration(1000);

            svg
                .selectAll(".message")
                .data(messages, function (d){ return d.id})
                .join(
                    enter =>
                        enter
                            .append('rect')
                            .attr("class", "message")
                            .attr("rx", 6)
                            .attr("ry", 6)
                            .attr("width", 300)
                            .attr("height", 60)
                            .attr("x", d => {return tarray[d.trans].x})
                            .attr("y", d => {return tarray[d.trans].y})
                            .attr("opacity", d => {return tarray[d.trans].opacity})
                            .style("fill", "blue")
                            .call(
                                enter => enter.transition(t)
                                    .attr("x", w-300)
                                    .attr("y", function(d,i) {return i*70 + 10})
                                    .attr("opacity", 1)
                            ),

                    update =>
                        update
                            .call(update => update.transition(t)
                                .attr("y", function(d,i) {return i*70 + 10})
                                .attr("opacity", function (d,i) {
                                    return oscale(i)
                                })
                            )

                )
        }
        addmessage();

        var set = setInterval(addmessage, 2000);







    </script>

</body>
</html>